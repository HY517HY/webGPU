# webGPU实现透视相机理论基础
webGPU透视相机详解，在学习透视相机时，发现所有学习资源总结的不够清晰，特写下此贴。
# model martix、view martix、perspective martix
在介绍之前首先给出三个坐标系：  
世界坐标系：简单理解为输入数据的原始坐标系（真实世界的坐标系）；  
相机坐标系：在通过相机观察时，希望相机位置对应坐标系“原点”，相机朝向对应z方向，（通过视图矩阵将世界坐标系变换到相机坐标系）；
裁剪坐标系（NDC坐标系）：即webGPU的裁剪空间（左手系），值得注意的是webGPU的的z取值范围为[0,1]不同于openGL（世界坐标-->NDC坐标下面会详细介绍）。
# webGPU的一些默认操作
1.webGPU在渲染时会默认执行齐次操作（这对后续的投影矩阵的推导右很重要的作用）；  
2.webGPU在将buffer里面的数组数据读取为矩阵时是按列主序的（及先填充满第一列再进行后续列填充）。
# 相机朝向
在浏览各个学习资料时，都会说右手系默认相机方向为-z方向为什么？  
事实上，相机朝向仅与eye和target构建的target - eye的朝向有关，当eye的z大于target的z时，相机自然朝-z方向。为方便后续推理，本文后续的所有推导操作都设定为相机朝-z方向。
# 初等变换阵
若在着色器中定义这个计算函数 vsouput.position = uniform.martix * position，显然变换矩阵左乘位置，所以想当然觉得存入uniform buffer的矩阵是一个初等行变换矩阵？  
结果显然不是。  
如前文所说，数组数据读取为矩阵时是按列主序的，也就是uniform.martix事实上已经对原始数据进行转置了，所以传入buffer的矩阵应该时初等列变换矩阵。此外，矩阵的乘法顺序可以不可变的，
正常的矩阵乘法顺序为：P * V * M。但是由于转置，矩阵的乘法顺序变为： M的转置 * V的转置 * P的转置。
# 透视矩阵的推导
详细推导可见：https://juejin.cn/post/7195251062662987833  
上述的推导有两个注意事项：
1.上述推导过程得到的时初等行变换矩阵，如果西药初等列变换矩阵需要进行转置；
2.上述时openGL的透视矩阵推导，在webGPU中，NDC的z需要映射到[0,1]，所以求得的A，B值也不同，正确为：  
A= n/(n-f), B = nf/(n-f)。
